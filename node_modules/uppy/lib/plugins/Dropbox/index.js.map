{"version":3,"sources":["../../../src/plugins/Dropbox/index.js"],"names":["Plugin","require","Provider","View","icons","module","exports","core","opts","type","id","title","stateId","icon","Dropbox","host","provider","files","onAuth","bind","render","defaultOptions","install","view","setState","dropbox","authenticated","folders","directories","activeRow","filterInput","isSearchVisible","target","plugin","mount","uninstall","unmount","updateState","getFolder","isFolder","item","is_dir","getItemData","size","bytes","getItemIcon","startsWith","getItemSubList","contents","getItemName","path","length","substring","getMimeType","mime_type","getItemId","rev","getItemRequestPath","encodeURIComponent","getItemModifiedDate","modified","getItemThumbnailUrl","state"],"mappings":"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","file":"index.js","sourcesContent":["const html = require('yo-yo')\nconst Plugin = require('../Plugin')\n\nconst Provider = require('../../uppy-base/src/plugins/Provider')\n\nconst View = require('../../generic-provider-views/index')\nconst icons = require('./icons')\n\nmodule.exports = class Dropbox extends Plugin {\n  constructor (core, opts) {\n    super(core, opts)\n    this.type = 'acquirer'\n    this.id = 'Dropbox'\n    this.title = 'Dropbox'\n    this.stateId = 'dropbox'\n    this.icon = () => html`\n      <svg class=\"UppyIcon\" width=\"128\" height=\"118\" viewBox=\"0 0 128 118\">\n        <path d=\"M38.145.777L1.108 24.96l25.608 20.507 37.344-23.06z\"/>\n        <path d=\"M1.108 65.975l37.037 24.183L64.06 68.525l-37.343-23.06zM64.06 68.525l25.917 21.633 37.036-24.183-25.61-20.51z\"/>\n        <path d=\"M127.014 24.96L89.977.776 64.06 22.407l37.345 23.06zM64.136 73.18l-25.99 21.567-11.122-7.262v8.142l37.112 22.256 37.114-22.256v-8.142l-11.12 7.262z\"/>\n      </svg>\n    `\n\n    // writing out the key explicitly for readability the key used to store\n    // the provider instance must be equal to this.id.\n    this.Dropbox = new Provider(core, {\n      host: this.opts.host,\n      provider: 'dropbox'\n    })\n\n    this.files = []\n\n    this.onAuth = this.onAuth.bind(this)\n    // Visual\n    this.render = this.render.bind(this)\n\n    // set default options\n    const defaultOptions = {}\n\n    // merge default options with the ones set by user\n    this.opts = Object.assign({}, defaultOptions, opts)\n  }\n\n  install () {\n    this.view = new View(this)\n    // Set default state\n    this.core.setState({\n      // writing out the key explicitly for readability the key used to store\n      // the plugin state must be equal to this.stateId.\n      dropbox: {\n        authenticated: false,\n        files: [],\n        folders: [],\n        directories: [],\n        activeRow: -1,\n        filterInput: '',\n        isSearchVisible: false\n      }\n    })\n\n    const target = this.opts.target\n    const plugin = this\n    this.target = this.mount(target, plugin)\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n\n  onAuth (authenticated) {\n    this.view.updateState({authenticated})\n    if (authenticated) {\n      this.view.getFolder()\n    }\n  }\n\n  isFolder (item) {\n    return item.is_dir\n  }\n\n  getItemData (item) {\n    return Object.assign({}, item, {size: item.bytes})\n  }\n\n  getItemIcon (item) {\n    var icon = icons[item.icon]\n\n    if (!icon) {\n      if (item.icon.startsWith('folder')) {\n        icon = icons['folder']\n      } else {\n        icon = icons['page_white']\n      }\n    }\n    return icon()\n  }\n\n  getItemSubList (item) {\n    return item.contents\n  }\n\n  getItemName (item) {\n    return item.path.length > 1 ? item.path.substring(1) : item.path\n  }\n\n  getMimeType (item) {\n    return item.mime_type\n  }\n\n  getItemId (item) {\n    return item.rev\n  }\n\n  getItemRequestPath (item) {\n    return encodeURIComponent(this.getItemName(item))\n  }\n\n  getItemModifiedDate (item) {\n    return item.modified\n  }\n\n  getItemThumbnailUrl (item) {\n    return `${this.opts.host}/${this.Dropbox.id}/thumbnail/${this.getItemRequestPath(item)}`\n  }\n\n  render (state) {\n    return this.view.render(state)\n  }\n}\n"]}