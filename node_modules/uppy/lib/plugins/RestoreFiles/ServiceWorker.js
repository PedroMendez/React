'use strict';

/* globals clients */

var fileCache = {};

self.addEventListener('install', function (event) {
  console.log('Installing Uppy Service Worker...');

  event.waitUntil(Promise.resolve().then(function () {
    return self.skipWaiting();
  }));
});

self.addEventListener('activate', function (event) {
  event.waitUntil(self.clients.claim());
});

function sendMessageToAllClients(msg) {
  clients.matchAll().then(function (clients) {
    clients.forEach(function (client) {
      client.postMessage(msg);
    });
  });
}

function addFile(file) {
  fileCache[file.id] = file;
  console.log('Added file to service worker cache:', file);
}

function removeFile(fileID) {
  delete fileCache[fileID];
  console.log('Removed file from service worker cache:', fileID);
}

function getFiles() {
  sendMessageToAllClients({ type: 'ALL_FILES', files: fileCache });
}

self.addEventListener('message', function (event) {
  switch (event.data.type) {
    case 'ADD_FILE':
      addFile(event.data.data);
      break;
    case 'REMOVE_FILE':
      removeFile(event.data.data);
      break;
    case 'GET_FILES':
      getFiles();
      break;
  }
});
//# sourceMappingURL=ServiceWorker.js.map