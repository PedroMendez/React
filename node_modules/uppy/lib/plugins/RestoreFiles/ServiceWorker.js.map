{"version":3,"sources":["../../../src/plugins/RestoreFiles/ServiceWorker.js"],"names":["fileCache","self","addEventListener","event","console","log","waitUntil","Promise","resolve","then","skipWaiting","clients","claim","sendMessageToAllClients","msg","matchAll","forEach","client","postMessage","addFile","file","id","removeFile","fileID","getFiles","type","files","data"],"mappings":";;AAAA;;AAEA,IAAMA,YAAY,EAAlB;;AAEAC,KAAKC,gBAAL,CAAsB,SAAtB,EAAiC,UAACC,KAAD,EAAW;AAC1CC,UAAQC,GAAR,CAAY,mCAAZ;;AAEAF,QAAMG,SAAN,CAAgBC,QAAQC,OAAR,GACXC,IADW,CACN;AAAA,WAAMR,KAAKS,WAAL,EAAN;AAAA,GADM,CAAhB;AAED,CALD;;AAOAT,KAAKC,gBAAL,CAAsB,UAAtB,EAAkC,UAACC,KAAD,EAAW;AAC3CA,QAAMG,SAAN,CAAgBL,KAAKU,OAAL,CAAaC,KAAb,EAAhB;AACD,CAFD;;AAIA,SAASC,uBAAT,CAAkCC,GAAlC,EAAuC;AACrCH,UAAQI,QAAR,GAAmBN,IAAnB,CAAwB,UAACE,OAAD,EAAa;AACnCA,YAAQK,OAAR,CAAgB,UAACC,MAAD,EAAY;AAC1BA,aAAOC,WAAP,CAAmBJ,GAAnB;AACD,KAFD;AAGD,GAJD;AAKD;;AAED,SAASK,OAAT,CAAkBC,IAAlB,EAAwB;AACtBpB,YAAUoB,KAAKC,EAAf,IAAqBD,IAArB;AACAhB,UAAQC,GAAR,CAAY,qCAAZ,EAAmDe,IAAnD;AACD;;AAED,SAASE,UAAT,CAAqBC,MAArB,EAA6B;AAC3B,SAAOvB,UAAUuB,MAAV,CAAP;AACAnB,UAAQC,GAAR,CAAY,yCAAZ,EAAuDkB,MAAvD;AACD;;AAED,SAASC,QAAT,GAAqB;AACnBX,0BAAwB,EAAEY,MAAM,WAAR,EAAqBC,OAAO1B,SAA5B,EAAxB;AACD;;AAEDC,KAAKC,gBAAL,CAAsB,SAAtB,EAAiC,UAACC,KAAD,EAAW;AAC1C,UAAQA,MAAMwB,IAAN,CAAWF,IAAnB;AACE,SAAK,UAAL;AACEN,cAAQhB,MAAMwB,IAAN,CAAWA,IAAnB;AACA;AACF,SAAK,aAAL;AACEL,iBAAWnB,MAAMwB,IAAN,CAAWA,IAAtB;AACA;AACF,SAAK,WAAL;AACEH;AACA;AATJ;AAWD,CAZD","file":"ServiceWorker.js","sourcesContent":["/* globals clients */\n\nconst fileCache = {}\n\nself.addEventListener('install', (event) => {\n  console.log('Installing Uppy Service Worker...')\n\n  event.waitUntil(Promise.resolve()\n      .then(() => self.skipWaiting()))\n})\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(self.clients.claim())\n})\n\nfunction sendMessageToAllClients (msg) {\n  clients.matchAll().then((clients) => {\n    clients.forEach((client) => {\n      client.postMessage(msg)\n    })\n  })\n}\n\nfunction addFile (file) {\n  fileCache[file.id] = file\n  console.log('Added file to service worker cache:', file)\n}\n\nfunction removeFile (fileID) {\n  delete fileCache[fileID]\n  console.log('Removed file from service worker cache:', fileID)\n}\n\nfunction getFiles () {\n  sendMessageToAllClients({ type: 'ALL_FILES', files: fileCache })\n}\n\nself.addEventListener('message', (event) => {\n  switch (event.data.type) {\n    case 'ADD_FILE':\n      addFile(event.data.data)\n      break\n    case 'REMOVE_FILE':\n      removeFile(event.data.data)\n      break\n    case 'GET_FILES':\n      getFiles()\n      break\n  }\n})\n"]}