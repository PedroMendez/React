{"version":3,"sources":["../../src/core/Utils.js"],"names":["throttle","require","fileType","flatten","arr","concat","apply","isTouchDevice","window","navigator","maxTouchPoints","truncateString","str","length","substr","secondsToTime","rawSeconds","hours","Math","floor","minutes","seconds","groupBy","array","groupingFn","reduce","result","item","key","xs","get","push","set","Map","every","predicateFn","toArray","list","Array","prototype","slice","call","generateFileID","file","fileID","name","toLowerCase","replace","data","lastModified","extend","objs","Object","assign","runPromiseSequence","functions","args","promise","Promise","resolve","forEach","func","then","isPreviewSupported","fileTypeSpecific","test","getArrayBuffer","chunk","reject","reader","FileReader","addEventListener","e","target","err","console","error","readAsArrayBuffer","getFileType","emptyFileType","extensionsToMime","isRemote","type","split","fileExtension","getFileNameAndExtension","buffer","mime","catch","mimeToExtensions","getFileTypeExtension","mimeType","fullFileName","re","fileExt","exec","fileName","supportsMediaRecorder","MediaRecorder","start","isObjectURL","url","indexOf","getProportionalHeight","img","width","aspect","height","round","createThumbnail","targetWidth","originalUrl","URL","createObjectURL","onload","image","Image","src","revokeObjectURL","onerror","Error","targetHeight","canvas","resizeImage","canvasToBlob","blob","sourceWidth","sourceHeight","steps","log","stepScaled","downScaleInSteps","document","createElement","context","getContext","drawImage","source","currentWidth","currentHeight","i","quality","toBlob","dataURItoBlob","toDataURL","dataURI","opts","toFile","binary","atob","charCodeAt","File","Uint8Array","Blob","dataURItoFile","copyToClipboard","textToCopy","fallbackString","textArea","setAttribute","position","top","left","padding","border","outline","boxShadow","background","value","body","appendChild","select","magicCopyFailed","removeChild","prompt","successful","execCommand","getSpeed","fileProgress","bytesUploaded","timeElapsed","Date","uploadStarted","uploadSpeed","getBytesRemaining","bytesTotal","getETA","bytesRemaining","secondsRemaining","prettyETA","time","hoursStr","minutesVal","minutesStr","secondsVal","secondsStr","isDOMElement","obj","nodeType","Node","ELEMENT_NODE","findDOMElement","element","querySelector","getSocketHost","regex","host","socketProtocol","location","protocol","_emitSocketProgress","uploader","progressData","progress","core","emitter","emit","id","emitSocketProgress","leading","trailing","module","exports"],"mappings":"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","file":"Utils.js","sourcesContent":["const throttle = require('lodash.throttle')\n// we inline file-type module, as opposed to using the NPM version,\n// because of this https://github.com/sindresorhus/file-type/issues/78\n// and https://github.com/sindresorhus/copy-text-to-clipboard/issues/5\nconst fileType = require('../vendor/file-type')\n\n/**\n * A collection of small utility functions that help with dom manipulation, adding listeners,\n * promises and other good things.\n *\n * @module Utils\n */\n\n/**\n * Shallow flatten nested arrays.\n */\nfunction flatten (arr) {\n  return [].concat.apply([], arr)\n}\n\nfunction isTouchDevice () {\n  return 'ontouchstart' in window || // works on most browsers\n          navigator.maxTouchPoints   // works on IE10/11 and Surface\n}\n\n// /**\n//  * Shorter and fast way to select a single node in the DOM\n//  * @param   { String } selector - unique dom selector\n//  * @param   { Object } ctx - DOM node where the target of our search will is located\n//  * @returns { Object } dom node found\n//  */\n// function $ (selector, ctx) {\n//   return (ctx || document).querySelector(selector)\n// }\n\n// /**\n//  * Shorter and fast way to select multiple nodes in the DOM\n//  * @param   { String|Array } selector - DOM selector or nodes list\n//  * @param   { Object } ctx - DOM node where the targets of our search will is located\n//  * @returns { Object } dom nodes found\n//  */\n// function $$ (selector, ctx) {\n//   var els\n//   if (typeof selector === 'string') {\n//     els = (ctx || document).querySelectorAll(selector)\n//   } else {\n//     els = selector\n//     return Array.prototype.slice.call(els)\n//   }\n// }\n\nfunction truncateString (str, length) {\n  if (str.length > length) {\n    return str.substr(0, length / 2) + '...' + str.substr(str.length - length / 4, str.length)\n  }\n  return str\n\n  // more precise version if needed\n  // http://stackoverflow.com/a/831583\n}\n\nfunction secondsToTime (rawSeconds) {\n  const hours = Math.floor(rawSeconds / 3600) % 24\n  const minutes = Math.floor(rawSeconds / 60) % 60\n  const seconds = Math.floor(rawSeconds % 60)\n\n  return { hours, minutes, seconds }\n}\n\n/**\n * Partition array by a grouping function.\n * @param  {[type]} array      Input array\n * @param  {[type]} groupingFn Grouping function\n * @return {[type]}            Array of arrays\n */\nfunction groupBy (array, groupingFn) {\n  return array.reduce((result, item) => {\n    let key = groupingFn(item)\n    let xs = result.get(key) || []\n    xs.push(item)\n    result.set(key, xs)\n    return result\n  }, new Map())\n}\n\n/**\n * Tests if every array element passes predicate\n * @param  {Array}  array       Input array\n * @param  {Object} predicateFn Predicate\n * @return {bool}               Every element pass\n */\nfunction every (array, predicateFn) {\n  return array.reduce((result, item) => {\n    if (!result) {\n      return false\n    }\n\n    return predicateFn(item)\n  }, true)\n}\n\n/**\n * Converts list into array\n*/\nfunction toArray (list) {\n  return Array.prototype.slice.call(list || [], 0)\n}\n\n/**\n * Takes a fileName and turns it into fileID, by converting to lowercase,\n * removing extra characters and adding unix timestamp\n *\n * @param {String} fileName\n *\n */\nfunction generateFileID (file) {\n  let fileID = file.name.toLowerCase()\n  fileID = fileID.replace(/[^A-Z0-9]/ig, '')\n  fileID = fileID + file.data.lastModified\n  return fileID\n}\n\nfunction extend (...objs) {\n  return Object.assign.apply(this, [{}].concat(objs))\n}\n\n/**\n * Runs an array of promise-returning functions in sequence.\n */\nfunction runPromiseSequence (functions, ...args) {\n  let promise = Promise.resolve()\n  functions.forEach((func) => {\n    promise = promise.then(() => func(...args))\n  })\n  return promise\n}\n\n/**\n * Takes function or class, returns its name.\n * Because IE doesn’t support `constructor.name`.\n * https://gist.github.com/dfkaye/6384439, http://stackoverflow.com/a/15714445\n *\n * @param {Object} fn — function\n *\n */\n// function getFnName (fn) {\n//   var f = typeof fn === 'function'\n//   var s = f && ((fn.name && ['', fn.name]) || fn.toString().match(/function ([^\\(]+)/))\n//   return (!f && 'not a function') || (s && s[1] || 'anonymous')\n// }\n\nfunction isPreviewSupported (fileTypeSpecific) {\n  // list of images that browsers can preview\n  if (/^(jpeg|gif|png|svg|svg\\+xml|bmp)$/.test(fileTypeSpecific)) {\n    return true\n  }\n  return false\n}\n\nfunction getArrayBuffer (chunk) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader()\n    reader.addEventListener('load', function (e) {\n      // e.target.result is an ArrayBuffer\n      resolve(e.target.result)\n    })\n    reader.addEventListener('error', function (err) {\n      console.error('FileReader error' + err)\n      reject(err)\n    })\n    // file-type only needs the first 4100 bytes\n    reader.readAsArrayBuffer(chunk)\n  })\n}\n\nfunction getFileType (file) {\n  const emptyFileType = ['', '']\n  const extensionsToMime = {\n    'md': 'text/markdown',\n    'markdown': 'text/markdown',\n    'mp4': 'video/mp4',\n    'mp3': 'audio/mp3'\n  }\n\n  // no smart detection for remote files, just trust the provider\n  if (file.isRemote) {\n    return Promise.resolve(file.type.split('/'))\n  }\n\n  const fileExtension = getFileNameAndExtension(file.name)[1]\n\n  // 1. try to determine file type from magic bytes with file-type module\n  // this should be the most trustworthy way\n  const chunk = file.data.slice(0, 4100)\n  return getArrayBuffer(chunk)\n    .then((buffer) => {\n      const type = fileType(buffer)\n      if (type && type.mime) {\n        return type.mime.split('/')\n      }\n\n      // 2. if that’s no good, check if mime type is set in the file object\n      if (file.type) {\n        return file.type.split('/')\n      }\n\n      // 3. if that’s no good, see if we can map extension to a mime type\n      if (extensionsToMime[fileExtension]) {\n        return extensionsToMime[fileExtension].split('/')\n      }\n\n      // if all fails, well, return empty\n      return emptyFileType\n    })\n    .catch(() => {\n      return emptyFileType\n    })\n\n    // if (file.type) {\n    //   return Promise.resolve(file.type.split('/'))\n    // }\n    // return mime.lookup(file.name)\n    // return file.type ? file.type.split('/') : ['', '']\n}\n\n// TODO Check which types are actually supported in browsers. Chrome likes webm\n// from my testing, but we may need more.\n// We could use a library but they tend to contain dozens of KBs of mappings,\n// most of which will go unused, so not sure if that's worth it.\nconst mimeToExtensions = {\n  'video/ogg': 'ogv',\n  'audio/ogg': 'ogg',\n  'video/webm': 'webm',\n  'audio/webm': 'webm',\n  'video/mp4': 'mp4',\n  'audio/mp3': 'mp3'\n}\n\nfunction getFileTypeExtension (mimeType) {\n  return mimeToExtensions[mimeType] || null\n}\n\n// returns [fileName, fileExt]\nfunction getFileNameAndExtension (fullFileName) {\n  var re = /(?:\\.([^.]+))?$/\n  var fileExt = re.exec(fullFileName)[1]\n  var fileName = fullFileName.replace('.' + fileExt, '')\n  return [fileName, fileExt]\n}\n\nfunction supportsMediaRecorder () {\n  return typeof MediaRecorder === 'function' && !!MediaRecorder.prototype &&\n    typeof MediaRecorder.prototype.start === 'function'\n}\n\n/**\n * Check if a URL string is an object URL from `URL.createObjectURL`.\n *\n * @param {string} url\n * @return {boolean}\n */\nfunction isObjectURL (url) {\n  return url.indexOf('blob:') === 0\n}\n\nfunction getProportionalHeight (img, width) {\n  const aspect = img.width / img.height\n  return Math.round(width / aspect)\n}\n\n/**\n * Create a thumbnail for the given Uppy file object.\n *\n * @param {{data: Blob}} file\n * @param {number} width\n * @return {Promise}\n */\nfunction createThumbnail (file, targetWidth) {\n  const originalUrl = URL.createObjectURL(file.data)\n\n  const onload = new Promise((resolve, reject) => {\n    const image = new Image()\n    image.src = originalUrl\n    image.onload = () => {\n      URL.revokeObjectURL(originalUrl)\n      resolve(image)\n    }\n    image.onerror = () => {\n      // The onerror event is totally useless unfortunately, as far as I know\n      URL.revokeObjectURL(originalUrl)\n      reject(new Error('Could not create thumbnail'))\n    }\n  })\n\n  return onload.then((image) => {\n    const targetHeight = getProportionalHeight(image, targetWidth)\n    const canvas = resizeImage(image, targetWidth, targetHeight)\n    return canvasToBlob(canvas, 'image/jpeg')\n  }).then((blob) => {\n    return URL.createObjectURL(blob)\n  })\n}\n\n/**\n * Resize an image to the target `width` and `height`.\n *\n * Returns a Canvas with the resized image on it.\n */\nfunction resizeImage (image, targetWidth, targetHeight) {\n  let sourceWidth = image.width\n  let sourceHeight = image.height\n\n  if (targetHeight < image.height / 2) {\n    const steps = Math.floor(Math.log(image.width / targetWidth) / Math.log(2))\n    const stepScaled = downScaleInSteps(image, steps)\n    image = stepScaled.image\n    sourceWidth = stepScaled.sourceWidth\n    sourceHeight = stepScaled.sourceHeight\n  }\n\n  const canvas = document.createElement('canvas')\n  canvas.width = targetWidth\n  canvas.height = targetHeight\n\n  const context = canvas.getContext('2d')\n  context.drawImage(image,\n    0, 0, sourceWidth, sourceHeight,\n    0, 0, targetWidth, targetHeight)\n\n  return canvas\n}\n\n/**\n * Downscale an image by 50% `steps` times.\n */\nfunction downScaleInSteps (image, steps) {\n  let source = image\n  let currentWidth = source.width\n  let currentHeight = source.height\n\n  const canvas = document.createElement('canvas')\n  const context = canvas.getContext('2d')\n  canvas.width = currentWidth / 2\n  canvas.height = currentHeight / 2\n\n  for (let i = 0; i < steps; i += 1) {\n    context.drawImage(source,\n      // The entire source image. We pass width and height here,\n      // because we reuse this canvas, and should only scale down\n      // the part of the canvas that contains the previous scale step.\n      0, 0, currentWidth, currentHeight,\n      // Draw to 50% size\n      0, 0, currentWidth / 2, currentHeight / 2)\n    currentWidth /= 2\n    currentHeight /= 2\n    source = canvas\n  }\n\n  return {\n    image: canvas,\n    sourceWidth: currentWidth,\n    sourceHeight: currentHeight\n  }\n}\n\n/**\n * Save a <canvas> element's content to a Blob object.\n *\n * @param {HTMLCanvasElement} canvas\n * @return {Promise}\n */\nfunction canvasToBlob (canvas, type, quality) {\n  if (canvas.toBlob) {\n    return new Promise((resolve) => {\n      canvas.toBlob(resolve, type, quality)\n    })\n  }\n  return Promise.resolve().then(() => {\n    return dataURItoBlob(canvas.toDataURL(type, quality), {})\n  })\n}\n\nfunction dataURItoBlob (dataURI, opts, toFile) {\n  // get the base64 data\n  var data = dataURI.split(',')[1]\n\n  // user may provide mime type, if not get it from data URI\n  var mimeType = opts.mimeType || dataURI.split(',')[0].split(':')[1].split(';')[0]\n\n  // default to plain/text if data URI has no mimeType\n  if (mimeType == null) {\n    mimeType = 'plain/text'\n  }\n\n  var binary = atob(data)\n  var array = []\n  for (var i = 0; i < binary.length; i++) {\n    array.push(binary.charCodeAt(i))\n  }\n\n  // Convert to a File?\n  if (toFile) {\n    return new File([new Uint8Array(array)], opts.name || '', {type: mimeType})\n  }\n\n  return new Blob([new Uint8Array(array)], {type: mimeType})\n}\n\nfunction dataURItoFile (dataURI, opts) {\n  return dataURItoBlob(dataURI, opts, true)\n}\n\n/**\n * Copies text to clipboard by creating an almost invisible textarea,\n * adding text there, then running execCommand('copy').\n * Falls back to prompt() when the easy way fails (hello, Safari!)\n * From http://stackoverflow.com/a/30810322\n *\n * @param {String} textToCopy\n * @param {String} fallbackString\n * @return {Promise}\n */\nfunction copyToClipboard (textToCopy, fallbackString) {\n  fallbackString = fallbackString || 'Copy the URL below'\n\n  return new Promise((resolve, reject) => {\n    const textArea = document.createElement('textarea')\n    textArea.setAttribute('style', {\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      width: '2em',\n      height: '2em',\n      padding: 0,\n      border: 'none',\n      outline: 'none',\n      boxShadow: 'none',\n      background: 'transparent'\n    })\n\n    textArea.value = textToCopy\n    document.body.appendChild(textArea)\n    textArea.select()\n\n    const magicCopyFailed = (err) => {\n      document.body.removeChild(textArea)\n      window.prompt(fallbackString, textToCopy)\n      return reject('Oops, unable to copy displayed fallback prompt: ' + err)\n    }\n\n    try {\n      const successful = document.execCommand('copy')\n      if (!successful) {\n        return magicCopyFailed('copy command unavailable')\n      }\n      document.body.removeChild(textArea)\n      return resolve()\n    } catch (err) {\n      document.body.removeChild(textArea)\n      return magicCopyFailed(err)\n    }\n  })\n}\n\nfunction getSpeed (fileProgress) {\n  if (!fileProgress.bytesUploaded) return 0\n\n  const timeElapsed = (new Date()) - fileProgress.uploadStarted\n  const uploadSpeed = fileProgress.bytesUploaded / (timeElapsed / 1000)\n  return uploadSpeed\n}\n\nfunction getBytesRemaining (fileProgress) {\n  return fileProgress.bytesTotal - fileProgress.bytesUploaded\n}\n\nfunction getETA (fileProgress) {\n  if (!fileProgress.bytesUploaded) return 0\n\n  const uploadSpeed = getSpeed(fileProgress)\n  const bytesRemaining = getBytesRemaining(fileProgress)\n  const secondsRemaining = Math.round(bytesRemaining / uploadSpeed * 10) / 10\n\n  return secondsRemaining\n}\n\nfunction prettyETA (seconds) {\n  const time = secondsToTime(seconds)\n\n  // Only display hours and minutes if they are greater than 0 but always\n  // display minutes if hours is being displayed\n  // Display a leading zero if the there is a preceding unit: 1m 05s, but 5s\n  const hoursStr = time.hours ? time.hours + 'h ' : ''\n  const minutesVal = time.hours ? ('0' + time.minutes).substr(-2) : time.minutes\n  const minutesStr = minutesVal ? minutesVal + 'm ' : ''\n  const secondsVal = minutesVal ? ('0' + time.seconds).substr(-2) : time.seconds\n  const secondsStr = secondsVal + 's'\n\n  return `${hoursStr}${minutesStr}${secondsStr}`\n}\n\n/**\n * Check if an object is a DOM element. Duck-typing based on `nodeType`.\n *\n * @param {*} obj\n */\nfunction isDOMElement (obj) {\n  return obj && typeof obj === 'object' && obj.nodeType === Node.ELEMENT_NODE\n}\n\n/**\n * Find a DOM element.\n *\n * @param {Node|string} element\n * @return {Node|null}\n */\nfunction findDOMElement (element) {\n  if (typeof element === 'string') {\n    return document.querySelector(element)\n  }\n\n  if (typeof element === 'object' && isDOMElement(element)) {\n    return element\n  }\n}\n\nfunction getSocketHost (url) {\n  // get the host domain\n  var regex = /^(?:https?:\\/\\/|\\/\\/)?(?:[^@\\n]+@)?(?:www\\.)?([^\\n]+)/\n  var host = regex.exec(url)[1]\n  var socketProtocol = location.protocol === 'https:' ? 'wss' : 'ws'\n\n  return `${socketProtocol}://${host}`\n}\n\nfunction _emitSocketProgress (uploader, progressData, file) {\n  const {progress, bytesUploaded, bytesTotal} = progressData\n  if (progress) {\n    uploader.core.log(`Upload progress: ${progress}`)\n    uploader.core.emitter.emit('core:upload-progress', {\n      uploader,\n      id: file.id,\n      bytesUploaded: bytesUploaded,\n      bytesTotal: bytesTotal\n    })\n  }\n}\n\nconst emitSocketProgress = throttle(_emitSocketProgress, 300, {leading: true, trailing: true})\n\nmodule.exports = {\n  generateFileID,\n  toArray,\n  every,\n  flatten,\n  groupBy,\n  extend,\n  runPromiseSequence,\n  supportsMediaRecorder,\n  isTouchDevice,\n  getFileNameAndExtension,\n  truncateString,\n  getFileTypeExtension,\n  getFileType,\n  getArrayBuffer,\n  isPreviewSupported,\n  isObjectURL,\n  createThumbnail,\n  secondsToTime,\n  dataURItoBlob,\n  dataURItoFile,\n  getSpeed,\n  getBytesRemaining,\n  getETA,\n  copyToClipboard,\n  prettyETA,\n  findDOMElement,\n  getSocketHost,\n  emitSocketProgress\n}\n"]}